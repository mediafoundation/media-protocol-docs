---
title: "Marketplace"
sidebar_label: Marketplace
sidebar_position: 1
---

# Marketplace Technical Reference

## Functions

### registerProvider

```solidity
function registerProvider(
    uint marketplaceId,
    string calldata label,
    string calldata publicKey,
    uint stakeAmount
) external onlyAuthorized nonReentrant;
```

Registers as provider in order to be able to create offers.

| Name          | Type                  |                                                                            |
|---------------|-----------------------|----------------------------------------------------------------------------|
| marketplaceId | `uint`                | The id of the marketplace you are registering to.                          |
| label         | `string`              | A vanity name for the provider.                                            |
| publicKey     | `string`              | The encryption public key shared to the clients to encrypt their resources.|
| stakeAmount   | `uint`                | The amount of LP token to stake to be a provider.                          |


Unregister as a provider and recover the staked lp tokens.

### updateProvider

```solidity
function updateProvider(
    uint marketplaceId,
    string calldata label,
    string calldata publicKey,
    uint stakeAmount
) external onlyAuthorized nonReentrant;
```

Updates the provider's information.

| Name          | Type                  |                                                    |
|---------------|-----------------------|----------------------------------------------------|
| marketplaceId | `uint`                | The id of the marketplace where you are registered.|
| label         | `string`              | The new vanity name for the provider.              |
| publicKey     | `string`              | The new encryption public key                      |
| stakeAmount   | `uint`                | The new amount of staked LP tokens.                |


### updateProviderStake

Updates only the provider's LP staked token amount.

```solidity
function updateProviderStake(
    uint marketplaceId, 
    uint stakeAmount
) external onlyAuthorized nonReentrant();
```

| Name          | Type   |                                                    |
|---------------|--------|----------------------------------------------------|
| marketplaceId | `uint` | The id of the marketplace where you are registered.|
| stakeAmount   | `uint` | The new amount of staked LP tokens.                |

### unregisterProvider

Unregisters provider from a given marketplace.

```solidity
function unregisterProvider(uint marketplaceId) external nonReentrant onlyAuthorized;
```

| Name          | Type   |                                                    |
|---------------|--------|----------------------------------------------------|
| marketplaceId | `uint` | The id of the marketplace where you are registered.|

### createOffer

Creates a new offer.

```solidity
function createOffer(
    uint marketplaceId,
    uint maximumDeals, 
    bool autoAccept, 
    uint pricePerSecond, 
    uint minDealDuration,
    bool billFullPeriods,
    bool singlePeriodOnly,
    string calldata metadata
) external nonReentrant;
```

| Name             | Type     |                                                                                                                                            |
|------------------|----------|--------------------------------------------------------------------------------------------------------------------------------------------|
| marketplaceId    | `uint`   | The id of the marketplace where you are registered.                                                                                        |
| maximumDeals     | `uint`   | The maximum amount of deals that this offer can provide.                                                                                   |
| autoAccept       | `bool`   | Defines whether the offer will auto-accept deals or not.                                                                                   |
| pricePerSecond   | `uint`   | Price per second for the deals.                                                                                                            |
| minDealDuration  | `uint`   | The minimum duration that deal's must have, expressed in seconds.                                                                          |
| billFullPeriods  | `bool`   | If enabled, once the minimum deal's duration has elapsed the next billing will cover a complete billing period up to the minimum duration. |
| singlePeriodOnly | `uint`   | If enabled, only one period will be billed and then the deal will be considered finished. (Can't extend for more periods)                  |
| metadata         | `string` | Useful additional information about the offer.                                                                                             |

---

### updateOffer

Updates an offer. It is important to clarify that once a Deal is taken, it cannot be modified. If you modify a offer with opened deals, only new Deals will follow the updated Offer parameters.

```solidity
function updateOffer(
    uint marketplaceId,
    uint offerId, 
    uint maximumDeals, 
    bool autoAccept, 
    uint pricePerSecond, 
    uint minDealDuration,
    bool billFullPeriods,
    bool singlePeriodOnly,
    string calldata metadata
) external nonReentrant;
```

| Name             | Type     |                                                                                                                                            |
|------------------|----------|--------------------------------------------------------------------------------------------------------------------------------------------|
| marketplaceId    | `uint`   | The id of the marketplace where you are registered.                                                                                        |
| offerId          | `uint`   | The id of the offer you want to update.                                                                                                    |
| maximumDeals     | `uint`   | The maximum amount of deals that this offer can provide.                                                                                   |
| autoAccept       | `bool`   | Defines whether the offer will auto-accept deals or not.                                                                                   |
| pricePerSecond   | `uint`   | Price per second for the deals.                                                                                                            |
| minDealDuration  | `uint`   | The minimum duration that deal's must have, expressed in seconds.                                                                          |
| billFullPeriods  | `bool`   | If enabled, once the minimum deal's duration has elapsed the next billing will cover a complete billing period up to the minimum duration. |
| singlePeriodOnly | `uint`   | If enabled, only one period will be billed and then the deal will be considered finished. (Can't extend for more periods)                  |
| metadata         | `string` | Useful additional information about the offer.                                                                                             |


### deleteOffer

Allows providers to delete their active offers.

```solidity
function deleteOffer(
    uint marketplaceId, 
    uint offerId
) external onlyAuthorized nonReentrant; 
```

| Name             | Type     |                                                     |
|------------------|----------|-----------------------------------------------------|
| marketplaceId    | `uint`   | The id of the marketplace where you are registered. |
| offerId          | `uint`   | The id of the offer you want to update.             |

---

### createDeal

Allows a client to create a Deal from an Offer. This can be called from the Operations Helper or from the client itself, as it uses onlyAuthorized modifier.

```solidity
  function createDeal(
      uint marketplaceId,
      uint resourceId,
      uint offerId,  
      uint blockedBalance,
      string calldata sharedKeyCopy
    ) external nonReentrant onlyAuthorized returns (uint dealId, uint actualDeposit)
```

- `createDeals(uint marketplaceId, ...) external returns (uint[] memory dealsId, uint totalDeposit)`: Clients can create deals based on available offers.

- `acceptDeal(uint marketplaceId, uint _dealId) external returns (bool)`: Providers can accept deals made by clients.

- Other functions exist for rejecting, canceling, and collecting deals.

---

### Events

Events are emitted for significant actions within the contract, such as registration of a provider, creation, acceptance, or cancellation of a deal.

---

### Modifiers

Modifiers are used to conditionally change the behavior of functions. For instance, certain functions can only be executed by the contract owner or by authorized proxies.

---

### Utility Functions

- `hasActiveDeals(uint marketplaceId, uint _offerId) public view returns (bool)`: Checks if a given offer ID has active deals associated with it.

- `isRegisteredProvider(uint marketplaceId, address _provider) public view returns (bool)`: Verifies if a given address is a registered provider.

---

### Administration

- `authorizeProxy(address _addr) external onlyOwner returns (bool)`: Contract owner can authorize an address to act as a proxy for creating deals.

- `deAuthorizeProxy(address _addr) external onlyOwner returns (bool)`: Contract owner can revoke an address's proxy authorization.

:::note
This is a high-level technical breakdown. For a deep understanding of each function's inner workings and logic, refer to the smart contract's actual implementation.
:::
